<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fredericka+the+Great&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
      integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
      integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="/nav.css" />
    <link rel="stylesheet" href="/book.css" />
    <link rel="stylesheet" href="/footer.css" />
    <link rel="stylesheet" href="/create.css" />
    <title>Traveller</title>
  </head>
  <body>
    <%- include('../includes/nav.ejs') %>
    <section id="book">
      <form
        method="post"
        id="create-form"
        novalidate
        action="/booking"
      >
        <h1 id="create-h1">Booking Details</h1>
        <fieldset>
          <div class="form-row">
            <label for="destinations" class="create-label">
              <span>Destinations</span> :  </label>
              <br />
              <input
              type="text"
              name="destination"
              id="title"
              class="create-input"
              value="<%= data[0].title %>"
              required
              readonly
            />
              
          </div>
          <div class="form-row">
            <label for="price" class="create-label">
              <span>Price</span> : <span id="price"><%= data[0].price %></span><span id="pricespan"
                >/night</span
              > 
            </label>
          </div>
          <div class="form-row">
            <label for="name" class="create-label">Name:</label><br />
            <input
              type="text"
              name="name"
              id="title"
              class="create-input"
              value="<%= curruser.username %>"
              required
            />
            <div class="invalid-feedback">Doesn't Looks good!</div>
          </div>

          <div class="form-row">
            <div id="book-date">
              <label class="create-label" for="date-from" id="date-from"
                >From :</label
              >
              <input
                type="text"
                id="firstRangeInput"
                placeholder="Start date"
                class="date-input"
                name="datefrom"
              />
              <div class="invalid-feedback">Doesn't Looks good!</div>

              <label class="create-label" for="date-to" id="date-to"
                >To :</label
              >
              <input
                type="text"
                id="secondRangeInput"
                placeholder="End date"
                class="date-input"
                name="dateto"
              />
              <div class="invalid-feedback">Doesn't Looks good!</div>
            </div>
          </div>

          <div class="form-row">
            <div class="book-select">
              <label class="create-label" for="adult"
                >Adults<span id="senior-age">(18+)</span>:</label
              >
              <input
              name="adult"
                type="number"
                class="book-select-input"
                id="select-adult"
                value="1"
                max="2"
              />
            </div>
            <div class="book-select">
              <label class="create-label" for="children">Childrens:</label>
              <input
                type="number"
                class="book-select-input"
                id="select-children"
                value="0"
                name="children"
              />
            </div>
            <div class="book-select">
              <label class="create-label" for="senior"
                >Senior Citizens<span id="senior-age">(60+)</span> :</label
              >
              <input
                type="number"
                class="book-select-input"
                id="select-senior"
                value="0"
                name="senior"
              />
            </div>
          </div>

          <div class="form-row">
            <div class="row1">
              <label class="create-label" for="total-days">Total Days:</label>
              <p  class="totals" >
                <input 
                id="total-days"
               readonly
                type="text"
                name="totaldays"
                class="create-input"
                required>
              </input>
              </p>
              <div class="invalid-feedback">Doesn't Looks good!</div>
            </div>

            <div class="row2">
              <label class="create-label" for="total-price">Total Price:</label
              >
              <p  class="totals">
                <input 
                id="total-price"
                type="text"
                class="create-input"
                name="totalprice"
                readonly
                required>
              </input>
            </p>
              <div class="invalid-feedback">Doesn't Looks good!</div>
            </div>
          </div>
          <div class="form-row">
            <label class="create-label" for="email-cnfrm"
              >Email Confirmation(Ticket Purpose) :</label
            ><br />
            <input
              class="create-input"
              type="text"
              id="country"
              name="email"
              required
            />
            <div class="invalid-feedback">Doesn't Looks good!</div>
          </div>

          <button type="button" class="create-button"  onclick="cnfrmation()">Confirm</button>
        </fieldset>

        <div id="overlay"></div>

        <div id="cnfrmation">
        
            <h3>Your booking is Confirmed</h3>
            <button type="submit" class="cnfrm-button">OK</button>
     
        </div>
      </form>
    </section>
    
    <%- include('../includes/footer.ejs') %>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/rangePlugin.js"></script>
    
    <script>
      
        flatpickr("#firstRangeInput", {
          plugins: [new rangePlugin({ input: "#secondRangeInput" })],
          minDate: "today",
          disableMobile: true,
          dateFormat: "d-m-Y",
          onChange: function(selectedDates) {
            if (selectedDates.length === 2) {
            const start = selectedDates[0];
            const end = selectedDates[1];

            const diffTime = end - start;
            const totalDays = diffTime / (1000 * 60 * 60 * 24) + 1; // inclusive

            document.getElementById("total-days").value = totalDays+" days";
            let totalPrice = document.getElementById("price").innerText * totalDays;
            document.getElementById("total-price").value = totalPrice+"â‚¹";
            console.log(document.getElementById("total-price"))
            
          }
        }
      }
      );

      
    </script>
    <script>
      let adult = document.querySelector("#select-adult");
      let child = document.querySelector("#select-children");
      let senior = document.querySelector("#select-senior");

      console.log(adult.value);
      child.addEventListener("change", () => {
        const adultVal = Number(adult.value);
        const childVal = Number(child.value);
        if (childVal > 0 && adultVal < 1) {
          console.log("chnaged");
          adult.value = 1;
        }
      });
      senior.addEventListener("change", () => {
        const adultVal = Number(adult.value);
        const seniorVal = Number(senior.value);
        if (seniorVal > 0 && adultVal < 1) {
          console.log("chnaged");
          adult.value = 1;
        }
      });

      function cnfrmation(){
        let cnfrm = document.querySelector("#cnfrmation");
        let bg = document.querySelector("#overlay");
        if (cnfrm.style.display !== "block") {
          cnfrm.style.display = "block";
          bg.style.display = "block";
      } else{
      cnfrm.style.display = "none";
        }
      }
      
    </script>
  </body>
</html>
